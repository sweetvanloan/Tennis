import pygame
import random
import pickle

# Initialize pygame
pygame.init()

# Set up display
WIDTH, HEIGHT = 800, 600
win = pygame.display.set_mode((WIDTH, HEIGHT))
pygame.display.set_caption("Tennis Game")

# Load sprite images and fonts
# ... (same as before)

# Initialize player names
player1_name = "Player 1"
player2_name = "Player 2"

# Initialize high scores
high_scores = []

# Load high scores from a file
try:
    with open("high_scores.pickle", "rb") as file:
        high_scores = pickle.load(file)
except FileNotFoundError:
    pass

# Define game elements with sprite images
# ... (same as before)

# Define font for player names and high scores
font = pygame.font.Font(None, 36)

# Function to display player names
def display_player_names():
    player1_text = font.render(f"{player1_name}", True, (255, 255, 255))
    player2_text = font.render(f"{player2_name}", True, (255, 255, 255))
    win.blit(player1_text, (WIDTH // 4, 10))
    win.blit(player2_text, (3 * WIDTH // 4 - player2_text.get_width(), 10))

# Function to display high scores
def display_high_scores():
    high_scores.sort(reverse=True)  # Sort high scores in descending order
    y = 50
    for i, score in enumerate(high_scores[:10]):
        score_text = font.render(f"{i + 1}. {score}", True, (255, 255, 255))
        win.blit(score_text, (WIDTH // 2 - score_text.get_width() // 2, y))
        y += 30

# Main game loop
while True:
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            # Save high scores to a file before quitting
            with open("high_scores.pickle", "wb") as file:
                pickle.dump(high_scores, file)
            pygame.quit()
            exit()

        # Allow players to enter their names
        if event.type == pygame.KEYDOWN:
            if player1_name == "Player 1":
                if event.key == pygame.K_RETURN:
                    player1_name = player1_name_input
            if player2_name == "Player 2":
                if event.key == pygame.K_RETURN:
                    player2_name = player2_name_input

    # ... (same as before)

    # Draw everything
    win.fill((0, 0, 0))
    display_player_names()
    display_high_scores()
    win.blit(player_image, player)
    win.blit(opponent_image, opponent)
    win.blit(ball_image, ball)

    pygame.display.flip()
    clock.tick(60)

# Quit pygame
pygame.quit()
